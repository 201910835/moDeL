<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"></script>
    <!-- Load BodyPix -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"></script>

    {% block head %} {% endblock %}
    <title>moDeL{% block title %}{% endblock %}</title>

</head>
<body>
            <nav class="navbar navbar-expand-lg navbar-light bg-dark">
              <div class="container-fluid">
                <a class="navbar-brand text-light" href="/">moDeL</a>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                  <div class="navbar-nav">
                    <a class="nav-link text-light" aria-current="page" href="/">Home</a>
                    <a class="nav-link text-light" href="{% url 'photo:photo_upload' %}">Upload</a>
                      <a class="nav-link text-light" href="{% url 'photo:realtime' %}">ÏÇ¨ÏßÑ Ï∞çÍ∏∞</a>

                  </div>
                </div>
              </div>
            </nav>

        {% block content %}
        {% endblock %}

        <footer class="container-fluid" id="footer" style="text-align: left; padding: 40px;">
            <p>&copy; smu deep learning 2021-1</p>
        </footer>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/jquery/1.12.4/jquery.min.js"></script>
      <script>
                var data = new Array();
                var size = 0;
                var width = 0;
                var height = 0;
                var first_face = 0.0;
                var last_face = 0.0;
                var last_foot = 0.0;
                var ratio = 0.0;

                async function loadAndPredict() {
                    for (var i = 0; i < document.images.length; i++) {
                        const net = await bodyPix.load(/** optional arguments, see below **/);

                        const segmentation = await net.segmentPersonParts(document.images[i], {
                            flipHorizontal: false,
                            internalResolution: 'medium',
                            segmentationThreshold: 0.7
                        });

                        console.log(segmentation);

                        width = segmentation.width;
                        height = segmentation.height;
                        size = width * height;

                        for (var i = 0; i < size; i++) {
                            data[i] = segmentation.data[i];
                        }

                        console.log(data)

                        loop1:
                            for (var y = 0; y < height; y++) {
                                for (var x = 0; x < width; x++) {
                                    if (data[y * width + x] == 1) {
                                        first_face = y
                                        break loop1;
                                    }
                                }
                            }

                        loop2:
                            for (var y = height - 1; y >= 0; y--) {
                                for (var x = 0; x < width; x++) {
                                    if (data[y * width + x] == 1) {
                                        last_face = y
                                        break loop2;
                                    }
                                }
                            }

                        loop3:
                            for (var y = height - 1; y >= 0; y--) {
                                for (var x = 0; x < width; x++) {
                                    if (data[y * width + x] == 23) {
                                        last_foot = y
                                        break loop3;
                                    }
                                }
                            }

                        console.log(first_face, last_face, last_foot)

                        ratio = ratio + (Math.abs((last_foot - first_face) / (last_face - first_face)))
                        console.log(ratio)

                    }
                    document.getElementById('ratio').innerHTML = "ÎãπÏã†Ïùò ÎπÑÏú®ÏùÄ " + ratio / document.images.length + " : " + Math.abs(10 - ratio / document.images.length) +"ÏûÖÎãàÎã§ üòÆ";

                }


                loadAndPredict();

      </script>
    {% block js %} {% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.6.0/dist/umd/popper.min.js" integrity="sha384-KsvD1yqQ1/1+IA7gi3P0tyJcT3vR+NdBTt13hSJ2lnve8agRGXTTyNaBYmCR/Nwi" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js" integrity="sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG" crossorigin="anonymous"></script>
</html>